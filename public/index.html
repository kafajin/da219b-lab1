<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Receptsamling</title>
  </head>
  <body>
    <h1>Alla recept</h1>

    <!-- Tabell d√§r recepten visas -->
    <table border="1" id="dishTable"></table>

    <h2>L√§gg till nytt recept</h2>
    <!-- Formul√§r f√∂r att l√§gga till nytt recept -->
    <form id="dishForm">
      <input placeholder="Namn" name="name" required />
      <input
        placeholder="Ingredienser (kommaseparerat)"
        name="ingredients"
        required
      />
      <input placeholder="Tillagning" name="preparationSteps" required />
      <input placeholder="Tid" name="cookingTime" required />
      <input placeholder="Ursprung" name="origin" required />
      <input placeholder="Styrka" name="spiceLevel" />
      <button type="submit">L√§gg till</button>
    </form>

    <script>
      const table = document.getElementById("dishTable");
      const form = document.getElementById("dishForm");

      // Funktion f√∂r att h√§mta och visa alla recept
      async function fetchDishes() {
        const res = await fetch("/api/dishes");
        const dishes = await res.json();
        table.innerHTML =
          "<tr><th>Namn</th><th>Redigera</th><th>Ta bort</th></tr>" +
          dishes
            .map(
              (d) => `
    <tr>
      <td contenteditable="true" id="name-${d._id}">${d.name}</td>
      <td>
        <button onclick="updateDish('${d._id}')">‚úèÔ∏è</button>
      </td>
      <td>
        <button onclick="deleteDish('${d._id}')">üóë</button>
      </td>
    </tr>
  `
            )
            .join("");
      }

      // N√§r formul√§ret skickas in ‚Äì l√§gg till nytt recept
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(form).entries());
        data.ingredients = data.ingredients.split(",").map((i) => i.trim());
        await fetch("/api/dishes", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
        form.reset();
        fetchDishes(); // Ladda om listan
      });

      // Ta bort ett recept med DELETE
      async function deleteDish(id) {
        if (confirm("√Ñr du s√§ker?")) {
          await fetch(`/api/dishes/${id}`, { method: "DELETE" });
          fetchDishes();
        }
      }

      async function updateDish(id) {
        console.log("Uppdaterar id:", id);
        const nameCell = document.getElementById(`name-${id}`);
        const updatedName = nameCell.innerText;

        const res = await fetch(`/api/dishes/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name: updatedName }),
        });

        if (res.ok) {
          alert("Recept uppdaterat!");
          fetchDishes();
        } else {
          alert("Kunde inte uppdatera receptet.");
        }
      }

      // K√∂r n√§r sidan laddas
      fetchDishes();
    </script>
  </body>
</html>
