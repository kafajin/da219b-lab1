<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Receptsamling</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background-color: #f9f9f9;
        margin: 0;
        padding: 2rem;
      }

      h1,
      h2 {
        color: #333;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
        background-color: white;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        border-radius: 8px;
        overflow: hidden;
      }

      th,
      td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      th {
        background-color: #f0f0f0;
      }

      tr:hover {
        background-color: #f9f9f9;
      }

      td[contenteditable="true"] {
        outline: none;
        transition: background-color 0.3s;
      }

      td[contenteditable="true"]:focus {
        background-color: #e0f7fa;
      }

      button {
        padding: 0.4rem 0.8rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
      }

      button:hover {
        opacity: 0.9;
      }

      button[onclick*="updateDish"] {
        background-color: #4caf50;
        color: white;
      }

      button[onclick*="deleteDish"] {
        background-color: #f44336;
        color: white;
      }

      form {
        margin-top: 2rem;
        background-color: white;
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
      }

      form input {
        flex: 1 1 200px;
        padding: 0.5rem;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      form button {
        background-color: #2196f3;
        color: white;
      }
    </style>
  </head>
  <body>
    <h1>Alla recept</h1>

    <table id="dishTable"></table>

    <h2>L√§gg till nytt recept</h2>
    <form id="dishForm">
      <input placeholder="Namn" name="name" required />
      <input
        placeholder="Ingredienser (kommaseparerat)"
        name="ingredients"
        required
      />
      <input placeholder="Tillagning" name="preparationSteps" required />
      <input placeholder="Tid" name="cookingTime" required />
      <input placeholder="Ursprung" name="origin" required />
      <input placeholder="Styrka" name="spiceLevel" />
      <button type="submit">L√§gg till</button>
    </form>

    <script>
      const table = document.getElementById("dishTable");
      const form = document.getElementById("dishForm");

      // h√§mtar och visar recept
      async function fetchDishes() {
        const res = await fetch("/api/dishes");
        const dishes = await res.json();

        table.innerHTML =
          `
          <tr>
            <th>Namn</th>
            <th>Ingredienser</th>
            <th>Steg</th>
            <th>Tid</th>
            <th>Ursprung</th>
            <th>Styrka</th>
            <th>Redigera</th>
            <th>Ta bort</th>
          </tr>
        ` +
          dishes
            .map(
              (d) => `
          <tr>
            <td contenteditable="true" id="name-${d._id}">${d.name}</td>
            <td contenteditable="true" id="ingredients-${
              d._id
            }">${d.ingredients.join(", ")}</td>
            <td contenteditable="true" id="steps-${d._id}">${
                d.preparationSteps
              }</td>
            <td contenteditable="true" id="time-${d._id}">${d.cookingTime}</td>
            <td contenteditable="true" id="origin-${d._id}">${d.origin}</td>
            <td contenteditable="true" id="spice-${d._id}">${d.spiceLevel}</td>
            <td><button onclick="updateDish('${d._id}')">‚úèÔ∏è</button></td>
            <td><button onclick="deleteDish('${d._id}')">üóë</button></td>
          </tr>
        `
            )
            .join("");
      }

      // l√§gger till nytt recept
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(form).entries());
        data.ingredients = data.ingredients.split(",").map((i) => i.trim());
        await fetch("/api/dishes", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
        form.reset();
        fetchDishes();
      });

      //tar bort recept
      async function deleteDish(id) {
        if (confirm("√Ñr du s√§ker?")) {
          await fetch(`/api/dishes/${id}`, { method: "DELETE" });
          fetchDishes();
        }
      }

      //uppdaterar redigerade receptf√§lt
      async function updateDish(id) {
        const updatedDish = {
          name: document.getElementById(`name-${id}`).innerText,
          ingredients: document
            .getElementById(`ingredients-${id}`)
            .innerText.split(",")
            .map((i) => i.trim()),
          preparationSteps: document.getElementById(`steps-${id}`).innerText,
          cookingTime: document.getElementById(`time-${id}`).innerText,
          origin: document.getElementById(`origin-${id}`).innerText,
          spiceLevel: document.getElementById(`spice-${id}`).innerText,
        };

        const res = await fetch(`/api/dishes/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(updatedDish),
        });

        if (res.ok) {
          alert("Recept uppdaterat!");
          fetchDishes();
        } else {
          alert("Kunde inte uppdatera receptet.");
        }
      }

      fetchDishes();
    </script>
  </body>
</html>
